<!doctype HTML>
<html>
<script src="https://aframe.io/releases/0.9.1/aframe.min.js"></script>
<script src="https://unpkg.com/aframe-animation-component@^5.1.2/dist/aframe-animation-component.min.js"></script>
<script src="https://unpkg.com/aframe-orbit-controls@1.2.0/dist/aframe-orbit-controls.min.js"></script>
<script src="https://unpkg.com/aframe-text-geometry-component@0.5.1/dist/aframe-text-geometry-component.min.js"></script>

<script>
    AFRAME.registerComponent('input-listen', {
        init:
            function () {
                //Declaration and initialization of flag 
                //which exprains grip button is pressed or not.
                //"this.el" reffers ctlR or L in this function
                this.el.grip = false;
                //Called when trigger is pressed 
                this.el.addEventListener('triggerdown', function (e) {
                    //"this" reffers ctlR or L in this function
                    
                    
                    });
                });
                //Grip Pressed
                this.el.addEventListener('gripdown', function (e) {
                    //Setting grip flag as true.
                    this.grip = true;
                });
                //Grip Released
                this.el.addEventListener('gripup', function (e) {
                    //Setting grip flag as false.
                    this.grip = false;
                });
                //Raycaster intersected with something.
                this.el.addEventListener('raycaster-intersection', function (e) {
                    //Store first selected object as selectedObj 
                    this.selectedObj = e.detail.els[0];
                });
                //Raycaster intersection is finished.
                this.el.addEventListener('raycaster-intersection-cleared', function (e) {
                    //Clear information of selectedObj
                    this.selectedObj = null;
                });
                               
                //console.log(this);
            },
        //called evry frame.
        tick: function () {
            if (!this.el.selectedObj) { return; }
            if (!this.el.grip) { return; }
            //Getting raycaster component which is attatched to ctlR or L
            //this.el means entity of ctlR or L in this function.
            var ray = this.el.getAttribute("raycaster").direction;
            //setting tip of raycaster as 1.2m forward of controller.  
            var p = new THREE.Vector3(ray.x, ray.y, ray.z);
            p.normalize();
            p.multiplyScalar(1.2);
            //Convert local position into world coordinate.
            this.el.object3D.localToWorld(p);
            //Move selected object to follow the tip of raycaster.
            this.el.selectedObj.object3D.position.set(p.x, p.y, p.z);
        }
    });
</script>
  

  <body style='margin : 0px; overflow: hidden;'>
    <a-scene >
      <a-assets>

        <a-asset-item id="model" src="quant.glb" ></a-asset-item>


      </a-assets>
        <a-entity gltf-model="#model" position="-6.45 0 -13.974"  scale="1 1.17 1" rotation="90 0 0"  > ></a-entity>
        <a-entity oculus-touch-controls="hand: left"></a-entity>
        <a-entity oculus-touch-controls="hand: right"></a-entity>
        <a-entity camera look-controls wasd-controls="acceleration:500" position="0 5 0" ></a-entity>
        <a-entity id="rig"
          movement-controls
          position="25 0 25">
  <a-entity camera
            position="0 1.6 0"
            look-controls="pointerLockEnabled: true"></a-entity>
</a-entity>


    <a-plane color="black" height="10" width="10" scale="1.95 3.17 1" position="-1.139 0 -16.500" rotation="-90 0 0"></a-plane>

    </a-scene>
  </body>
</html>
